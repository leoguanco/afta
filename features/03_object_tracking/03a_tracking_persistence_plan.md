# Tracking Persistence Implementation Plan

## Goal Description

Implement file storage persistence for the Object Tracking module. This involves creating a MinIO adapter to save heavy player trajectory data (likely as Parquet files) to an S3-compatible object store, ensuring that valuable tracking data generated by the Vision Worker is preserved and accessible for analysis.

## User Review Required

> [!NOTE]
> This change requires a running MinIO instance and a configured `tracking-data` bucket.

## Proposed Changes

### Infrastructure Layer

#### [NEW] [minio_adapter.py](file:///d:/Workspace/afta/backend/src/infrastructure/storage/minio_adapter.py)

- Implement `MinIOAdapter` class inheriting from `ObjectStoragePort` (to be defined).
- Use `minio` Python client to handle file uploads.
- Implement `save_trajectories(match_id: str, trajectories: List[Trajectory])` which:
  - Converts trajectories to a standard DataFrame (Polars/Pandas).
  - Serializes to Parquet.
  - Uploads to `tracking/{match_id}.parquet`.

#### [MODIFY] [vision_tasks.py](file:///d:/Workspace/afta/backend/src/infrastructure/worker/tasks/vision_tasks.py)

- Import `MinIOAdapter`.
- Instantiate adapter in `process_video_task`.
- Replace `TODO` with `adapter.save_trajectories(...)`.

## Verification Plan

### Automated Tests

- **Integration Test:** `tests/integration/test_tracking_persistence.py`
  - Start a mock MinIO container (or use the dev service).
  - Create a list of dummy `Trajectory` objects.
  - Call `adapter.save_trajectories(...)`.
  - Use `minio_client` to list objects in the bucket and verify the file exists and is non-empty.

### Manual Verification

- Upload a short test video via API (`POST /api/v1/tracking/start`).
- Wait for the job to complete.
- Check MinIO Browser (usually `http://localhost:9001`) to see if the file `tracking/{id}.parquet` appears.
